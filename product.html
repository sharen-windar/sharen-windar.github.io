<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>共同供應契約 產品清單｜萬達科技股份有限公司</title>
  <meta name="description" content="共同供應契約：硬體與軟體產品清單、階層式選單、模糊搜尋、分頁瀏覽。" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <style>
  /* Free & commercial-friendly font: jf-openhuninn (OFL 1.1) */
  @font-face{font-family:'HunInn';src:url('https://cdn.jsdelivr.net/gh/marsnow/open-huninn-font@1.1/font/jf-openhuninn.woff') format('woff');font-weight:400;font-style:normal;font-display:swap}
  @font-face{font-family:'HunInn';src:url('https://cdn.jsdelivr.net/gh/marsnow/open-huninn-font@1.1/font/jf-openhuninn.ttf') format('truetype');font-weight:400;font-style:normal;font-display:swap}

  :root{
    --bg:#ffffff;
    --card:#ffffff;
    --muted:#4b6174;
    --text:#0b1f33;
    --brand:#007DB8;
    --brand-2:#1FB6FF;
    --accent:#66D1FF;
    --ring: 0 0 14px rgba(0,125,184,.28);
    --radius: 14px;
    --maxw: 1200px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:linear-gradient(135deg,#f2f8ff 0%,#ffffff 55%,#f8fbff 100%);color:var(--text);font-family:'HunInn','Noto Sans TC',system-ui,-apple-system,sans-serif}
  a{color:inherit;text-decoration:none}

  .container{max-width:var(--maxw);margin:0 auto;padding:0 20px}

  /* Header 與首頁一致 */
  .header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.9);backdrop-filter:blur(12px);border-bottom:1px solid rgba(0,125,184,.22)}
  .nav{display:flex;align-items:center;justify-content:space-between;height:64px}
  .brand{display:flex;gap:10px;align-items:center;font-family:"Orbitron",sans-serif;font-weight:800;color:var(--brand)}
  .logo{width:30px;height:30px;border-radius:8px;background:conic-gradient(from 90deg, var(--brand), var(--brand-2), var(--accent));box-shadow:0 0 16px rgba(43,110,245,.45)}
  .menu{display:flex;gap:14px}
  .menu a{padding:10px 12px;border-radius:10px;color:var(--text);opacity:.9}
  .menu a.active,.menu a:hover{background:linear-gradient(135deg, rgba(0,125,184,.10), rgba(31,182,255,.10));box-shadow:var(--ring)}
  .menu a,.menu a:visited,.menu a:hover,.menu a:focus{text-decoration:none}
  .menu-toggle{display:none;background:transparent;border:0;color:var(--text);font-size:20px}

  main{padding:28px 0 60px}
  h1{font-size:28px;margin:12px 0 6px}
  p.lead{color:var(--muted);margin:0 0 16px}

  /* 控制台 */
  .card{background:#fff;border:1px solid rgba(43,110,245,.22);border-radius:var(--radius);padding:14px;box-shadow:0 8px 20px rgba(102,182,255,.12)}
  .panel{display:grid;gap:12px;grid-template-columns:1fr 1fr;align-items:end}
  label{font-weight:600}
  select, input[type="text"]{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(43,110,245,.28);background:#fff;color:var(--text);max-width:100%}

  .search-box{
    display:grid;
    grid-template-columns:1fr 1fr 1fr;
    gap:12px;
    overflow:hidden;
  }
  @media (max-width: 960px){ .panel{grid-template-columns:1fr 1fr} .search-box{grid-template-columns:1fr} }
  @media (max-width: 768px){
    .search-box{padding:12px}
    .search-box select, .search-box input{ font-size:16px }
  }

  /* 桌機表格與容器 */
  .table-wrap{width:100%;overflow:auto;border-radius:12px}
  table{width:100%;border-collapse:collapse;min-width:720px}
  th,td{border:1px solid rgba(43,110,245,.22);padding:10px 12px;vertical-align:top}
  th{background:linear-gradient(180deg,#f3f8ff,#fff);text-align:left;white-space:nowrap}

  /* 手機卡片 */
  #listCards{display:none}
  .product-card{
    background:#fff;border:1px solid rgba(43,110,245,.22);border-radius:12px;padding:12px;box-shadow:0 4px 12px rgba(2,6,23,.08);margin-bottom:12px
  }
  .product-card p{margin:8px 0;line-height:1.5}
  .product-card p strong{display:inline-block;min-width:88px;color:#0b1f33}
  @media (max-width: 768px){
    #listTable{display:none}
    #listCards{display:block}
    .product-card{padding:14px}
    .product-card p{
      display:grid;
      grid-template-columns:minmax(88px, 30vw) 1fr;
      column-gap:10px;
      align-items:start;
    }
    .product-card p strong{justify-self:end;white-space:nowrap}
    .product-card p br{display:none}
    .product-card{word-break:break-word;overflow-wrap:anywhere}
  }

  /* 分頁 */
  #pagination{margin:15px auto;text-align:center}
  #pagination button{margin:0 4px;padding:8px 12px;border-radius:10px;border:1px solid rgba(43,110,245,.35);background:#fff;cursor:pointer}
  #pagination button[disabled]{opacity:.5;cursor:not-allowed;background:#f3f8ff}

  /* RWD 選單 */
  @media (max-width: 640px){
    .menu{display:none;position:absolute;right:20px;top:64px;background:#fff;flex-direction:column;padding:10px;border-radius:12px;border:1px solid rgba(0,125,184,.18)}
    .menu.show{display:flex}
    .menu-toggle{display:block}
  }
  </style>
</head>
<body>
  <header class="header">
    <div class="container nav">
      <div class="brand"><span class="logo"></span><span>萬達科技股份有限公司</span></div>
      <nav>
        <button class="menu-toggle" aria-label="開啟選單">☰</button>
        <div class="menu" id="menu">
          <a href="index.html#home">首頁</a>
          <a class="active" href="product.html" aria-current="page">共同供應契約</a>
          <a href="index.html#items">服務項目</a>
          <a href="index.html#services">服務內容說明</a>
          <a href="index.html#about">關於我們</a>
        </div>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1>共同供應契約 產品清單</h1>
    <p class="lead">先選擇「商品分類」，再選擇對應「組別」，或直接以關鍵字進行模糊搜尋。</p>

    <section class="card" style="margin-bottom:18px">
      <div class="panel search-box">
        <div>
          <label for="hw">商品分類</label>
          <select id="hw">
            <option value="">— 請選擇商品分類 —</option>
          </select>
        </div>
        <div>
          <label for="sw">組別</label>
          <select id="sw" disabled>
            <option value="">— 請先選擇商品分類 —</option>
          </select>
        </div>
        <div>
          <label for="q">模糊搜尋</label>
          <input id="q" type="text" placeholder="輸入型號、關鍵字、產地…">
        </div>
      </div>
    </section>

    <div id="pagination" style="margin: 15px auto;text-align: center;"></div>

    <!-- 桌機：表格（外層加水平捲動容器） -->
    <div class="table-wrap" style="margin-bottom: 30px;">
      <table id="listTable"></table>
    </div>

    <!-- 手機：卡片 -->
    <div id="listCards" style="margin-bottom: 30px;"></div>
  </main>

  <footer class="container" style="color:var(--muted);padding:20px 0;border-top:1px solid rgba(43,110,245,.22)">© <span id="y"></span> 萬達科技股份有限公司</footer>

  <script>
    // 年份與行動選單
    document.getElementById('y').textContent = new Date().getFullYear();
    const toggle = document.querySelector('.menu-toggle');
    const menuEl = document.getElementById('menu');
    if (toggle && menuEl) toggle.addEventListener('click', () => menuEl.classList.toggle('show'));

    // 元件
    const CATALOG_URL = '/json/json-file.txt'; // 絕對路徑，避免相對路徑差異
    const $hw = document.getElementById('hw');        // 商品分類
    const $sw = document.getElementById('sw');        // 組別
    const $q  = document.getElementById('q');         // 模糊搜尋
    const $table = document.getElementById('listTable');
    const $cards = document.getElementById('listCards');
    const $pager = document.getElementById('pagination');

    // 資料儲存
    let MAP = {};        // { category: [{ order, group, file }] }
    let CAT_ORDER = [];  // 類別顯示順序
    let rawData = [];    // 原始資料（已去掉標題列）
    let viewData = [];   // 搜尋後
    let pageSize = 20;
    let page = 1;

    // 動態欄位（重點）
    let COLS = [];       // 欄位順序（key 陣列）
    let HEADERS = [];    // 欄位標題（顯示文字）

    // 事件
    $hw.addEventListener('change', () => {
      const cat = $hw.value;
      if (cat) { populateGroup(cat); $sw.focus(); } else { populateCategory(); }
    });
    $sw.addEventListener('change', () => {
      const opt  = $sw.options[$sw.selectedIndex];
      const file = opt && opt.getAttribute('data-file');
      if (file) fetchJSON('/json/' + file);
    });
    $q.addEventListener('input', debounce(applySearch, 150));

    // 讀取階層目錄
    async function loadCatalog(){
      try{
        const res = await fetch(CATALOG_URL, { cache: 'no-store' });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const text = (await res.text()).replace(/^\uFEFF/, ''); // 去 BOM
        MAP = {}; CAT_ORDER = [];
        const lines = text.split(/\r?\n/);

        for (const raw of lines) {
          const line = raw.trim();
          if (!line || line.startsWith('#') || line.startsWith('//')) continue;
          // 格式：order;商品分類:xxx;組別:yyy;file.json（支援全形冒號）
          const m = line.match(/^([^;]+)\s*;\s*商品分類[:：]\s*([^;]+?)\s*;\s*組別[:：]\s*([^;]+?)\s*;\s*([^;]+)\s*$/);
          if (!m) { console.warn('無法解析的行：', line); continue; }

          const [, order, cat, grp, file] = m;
          if (!MAP[cat]) { MAP[cat] = []; CAT_ORDER.push(cat); }
          MAP[cat].push({ order, group: grp, file });
        }

        // 依 order 排序
        Object.keys(MAP).forEach(cat => MAP[cat].sort((a,b) => a.order.localeCompare(b.order)));

        populateCategory();

        // 預設載入第一個分類+組別
        if (CAT_ORDER.length) {
          const firstCat = CAT_ORDER[0];
          $hw.value = firstCat;
          populateGroup(firstCat);
          const first = (MAP[firstCat] || [])[0];
          if (first) { $sw.value = first.group; fetchJSON('/json/' + first.file); }
        }
      }catch(err){
        console.error(err);
        $hw.innerHTML = '<option value="">— 目錄讀取失敗 —</option>';
        $sw.innerHTML = '<option value="">— 目錄讀取失敗 —</option>';
        $sw.disabled = true;
      }
    }

    function populateCategory(){
      $hw.innerHTML = '<option value="">— 請選擇商品分類 —</option>' +
        CAT_ORDER.map(cat => `<option>${safe(cat)}</option>`).join('');
      $sw.innerHTML = '<option value="">— 請先選擇商品分類 —</option>';
      $sw.disabled = true;
    }

    function populateGroup(cat){
      const groups = MAP[cat] || [];
      $sw.innerHTML = '<option value="">— 請選擇組別 —</option>' +
        groups.map(g => `<option data-file="${safe(g.file)}">${safe(g.group)}</option>`).join('');
      $sw.disabled = groups.length === 0;
    }

    // 載入 JSON（動態偵測標題列與欄位）
    async function fetchJSON(path){
      try{
        const res = await fetch(path, { cache:'no-store' });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        if(!Array.isArray(data)) throw new Error('JSON 格式需為陣列');

        if (data.length === 0){
          COLS = []; HEADERS = []; rawData = [];
          applySearch(); // 會清空畫面
          return;
        }

        const first = data[0] || {};
        const second = data[1] || null;
        const keys0 = Object.keys(first);

        // 預期：第一筆是標題列（如新版 a-01-01.json）
        let hasHeaderRow = keys0.length > 0 && keys0.every(k => typeof first[k] === 'string');

        // 簡單排除「其實是資料列」的情況
        if (hasHeaderRow && second){
          const looksSame = keys0.every(k => String(first[k]) === String(second[k]));
          if (looksSame) hasHeaderRow = false;
        }

        COLS = keys0.slice();                                  // 欄位順序 = 第一筆的 key 順序
        HEADERS = hasHeaderRow ? COLS.map(k => first[k])       // 顯示用標題 = 標題列的值
                               : COLS.map(k => k);             // 後援：沒有標題列 → 用 key

        rawData = hasHeaderRow ? data.slice(1) : data.slice(); // 有標題列就跳過第一筆
        page = 1;

        applySearch();
      }catch(err){
        console.error(err);
        rawData = []; viewData = []; COLS = []; HEADERS = [];
        renderDesktopTable(); renderCards(); renderPager();
        $table.innerHTML = '<tr><td>讀取失敗：' + safe(path) + '</td></tr>';
      }
    }

    // 搜尋與渲染
    function applySearch(){
      const kw = ($q.value||'').trim().toLowerCase();
      if(!kw){ viewData = rawData.slice(); }
      else{
        viewData = rawData.filter(row => {
          const txt = Object.values(row).join('\n').toLowerCase();
          return kw.split(/\s+/).every(k => txt.includes(k));
        });
      }
      page = 1;
      renderDesktopTable();
      renderCards();
      renderPager();
    }

    function renderDesktopTable(){
      if (!COLS.length){
        $table.innerHTML = '';
        return;
      }
      const head = '<tr>' + HEADERS.map(h => `<th>${safe(h)}</th>`).join('') + '</tr>';
      const rows = pagedData().map(r => {
        const tds = COLS.map(c => `<td>${safe(r[c]) ?? '—'}</td>`).join('');
        return `<tr>${tds}</tr>`;
      }).join('');
      $table.innerHTML = head + rows;
    }

    function renderCards(){
      if (!COLS.length){
        $cards.innerHTML = '';
        return;
      }
      const rows = pagedData().map(r => {
        const lines = COLS.map((c, i) => `
          <p><strong>${safe(HEADERS[i])}</strong>${safe(r[c]) ?? '—'}</p>
        `).join('');
        return `<div class="product-card">${lines}</div>`;
      }).join('');
      $cards.innerHTML = rows;
    }

    function renderPager(){
      const total = viewData.length;
      const pages = Math.max(1, Math.ceil(total / pageSize));
      if(page > pages) page = pages;
      let html = '';
      for(let i=1;i<=pages;i++){
        html += (i===page) ? `<button disabled="">${i}</button>` : `<button>${i}</button>`;
      }
      $pager.innerHTML = html;
      Array.from($pager.querySelectorAll('button')).forEach((btn, i) => {
        btn.addEventListener('click', () => { page = i+1; renderDesktopTable(); renderCards(); renderPager(); });
      });
    }

    function pagedData(){ const start = (page-1)*pageSize; return viewData.slice(start, start+pageSize); }
    function safe(v){ if(v==null) return ''; return String(v).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function debounce(fn, wait){ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(this,args),wait); }; }

    // 啟動
    document.addEventListener('DOMContentLoaded', loadCatalog);
  </script>
</body>
</html>

